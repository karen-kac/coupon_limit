# 要件定義書：マップ連動型クーポン配信アプリ

## 1. アプリ概要
本アプリは、ユーザーが実際に店舗の近くを通った際にクーポンを取得できる位置情報連動型アプリである。マップ上にはクーポンが取得可能な店舗位置が表示され、取得期限が迫るほど割引率が上昇する。また、一定時間以内に取得されなかったクーポンはマップ上で爆発演出により消滅する。

---

## 2. ユーザー機能要件

### 2.1 クーポン表示機能
- 現在地を中心としたマップ上に、クーポン取得可能な店舗がアイコンとして表示される。
- 各クーポンには、以下の情報が表示される（アイコンタップ後の画面）：
  - 店舗名
  - クーポンタイトル
  - 現在の割引率
  - 残り取得時間（カウントダウン）

### 2.2 クーポン取得機能
- ユーザーが店舗の**半径20m以内（未定）**に入ると、クーポンが取得可能になる。
- クーポンはタップで取得でき、マイページに保存される。

### 2.3 割引率変化機能
- クーポンの有効期限が近づくほど、段階的に割引率がアップする（例：60分前→20%、30分前→30%、10分前→50%）。
- 割引率の変化はリアルタイムにマップ上でも反映。

### 2.4 クーポン消滅演出（爆発）
- クーポンの有効期限を過ぎた場合、マップ上で爆発アニメーションが表示され、アイコンが消滅する。
- 出現率低下/回復

### 2.5 クーポン履歴管理
- ユーザーは過去に取得したクーポンの一覧をマイページで確認できる。
- 使用済・未使用ステータスを確認可能。
- クーポン使用画面に何を表示するか


---

## 3. 店舗側機能要件（管理者用Web画面）

### 3.1 クーポン発行機能
- 店舗はWeb画面から以下を設定してクーポンを発行できる：
  - クーポン内容（例：10%OFFなど）
  - 対象商品・条件
  - 開始・終了時刻
  - 配信位置（緯度経度）
  - 割引率の上昇ルール（時間ごとの％）

### 3.2 クーポン管理
- 発行済クーポンの状況（取得数、取得率など）を確認可能。
- クーポンの再発行・キャンセルも可能。

---

## 4. 技術要件

### 4.1 webアプリ
- レスポンシブ（携帯）

### 4.2 マップ表示
- Google Maps API または Mapbox API を使用

### 4.3 通知 （できたら）
- プッシュ通知により、近くにクーポンがあることをユーザーに通知

### 4.4 バックエンド
- Firebase（認証、データベース、プッシュ通知）を想定

---

## 5. UI/UX要件（ユーザー）

### 5.1 ホーム画面（マップ）
- クーポンアイコンが（アニメーション付きで）表示
- アイコンをタップすると詳細表示ポップアップが開く

### 5.2 マイページ
- 取得済クーポンの一覧（フィルタ：使用済／未使用）
- クーポンをタップすると使用する画面が開く

### 5.3 クーポン演出
- 取得できるクーポンと遠いクーポンのアイコンの差別化：モーション？色？
- 未取得で期限切れ：爆発アニメーション

---

## 6. セキュリティ要件
- クーポン取得履歴はユーザーごとに管理し、再取得防止

---

## 7. 今後検討すべき事項（質問）

1. クーポンの取得範囲（○○m）は固定ですか？時間帯やユーザー属性で可変にしますか？
    - 固定、しない
3. 「爆発アニメーション」は視覚演出だけか、それとも通知（例：「逃したクーポンが爆発した！」）もありますか？
    - 視覚演出のみ
5. クーポンの同時取得上限はありますか？
    - なし
7. 店舗ごとのカスタマイズ（ロゴ表示、色指定）は必要ですか？
    - 優先順位低い